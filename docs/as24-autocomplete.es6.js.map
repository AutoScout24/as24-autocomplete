{"version":3,"file":"as24-autocomplete.es6.js","sources":["../src/as24-autocomplete-input.js","../src/data-sources/tags-data-source.js","../src/as24-autocomplete.js"],"sourcesContent":["\"use strict\";\n\nconst $ = (selector, root) => root.querySelector(selector);\nconst on = (event, cb, el) => el.addEventListener(event, cb);\n\nconst appendTo = target => child => { target.appendChild(child); return target };\n\nconst showList = list => {\n  list.classList.add('as24-autocomplete__list--visible');\n  return false;\n};\n\nconst hideList = list => e => {\n  list.classList.remove('as24-autocomplete__list--visible');\n  return false;\n};\n\nconst isListVisible = list =>\n  list.classList.contains('as24-autocomplete__list--visible');\n\n/**\n * Renders a li item for the suggestions list\n * @param {{key: string, value: string}} item\n * @returns {HTMLElement} {Element}\n */\nconst renderLI = item => {\n  var li = document.createElement('li');\n  li.classList.add('as24-autocomplete__list-item');\n  li.key = item.key;\n  li.innerText = item.value;\n  return li;\n};\n\nconst renderEmptyListItem = (emptyMessage) => {\n  var li = document.createElement('li');\n  li.classList.add('as24-autocomplete__list-item');\n  li.key = '';\n  li.innerText = emptyMessage;\n  return li;\n};\n\n/**\n * Renders a collection of raw suggestions to the list\n * @param {string} emptyMessage\n * @param {HTMLElement} list\n * @returns {Function}\n */\nconst renderList = (emptyMessage, list) => itemsModel => {\n  list.innerHTML = '';\n  var df = document.createDocumentFragment();\n  (itemsModel.length\n      ? itemsModel.map(renderLI)\n      : [renderEmptyListItem(emptyMessage)]\n  ).forEach(appendTo(df));\n  list.classList[itemsModel.length ? 'remove' : 'add']('as24-autocomplete__list--empty');\n  appendTo(list)(df);\n  showList(list);\n};\n\nconst fetchList = (dataSource, labelInput, list, emptyMessage) => e => {\n  e.stopPropagation();\n  dataSource.fetchItems(labelInput.value).then(renderList(emptyMessage, list));\n};\n\nconst selectItem = (valueInput, labelInput, li) => {\n  valueInput.value = li.key;\n  labelInput.value = li.innerText;\n};\n\nconst onItemClicked = (valueInput, labelInput, list) => e => {\n  selectItem(valueInput, labelInput, e.target);\n  hideList(list)(e);\n};\n\n/**\n *\n * @param {HTMLElement} list\n * @param {HTMLElement} selected\n */\nconst followSelectedItem = (dir, list, selected) => {\n  const listHeight = list.getBoundingClientRect().height;\n  const selectedTop = selected.offsetTop;\n  const selectedHeight = selected.offsetHeight;\n  let scrollDist = dir === 1\n    ? -1 * (listHeight - (selectedTop + selectedHeight))\n    : selectedTop;\n  if (dir === 1 && scrollDist > 0) {\n    list.scrollTop = scrollDist;\n  }\n  if (dir === -1 && selectedTop < listHeight) {\n    list.scrollTop = scrollDist;\n  }\n};\n\n\nconst moveSelection = (dir, list) => {\n  var next = dir === 1 ? 'nextSibling' : 'previousSibling';\n  var currActiveItem = $('.as24-autocomplete__list-item--selected', list);\n  var nextActiveItem = currActiveItem === null\n    ? $('.as24-autocomplete__list-item', list)\n    : !!currActiveItem[next]\n      ? currActiveItem[next]\n      : currActiveItem;\n  currActiveItem && currActiveItem.classList.remove('as24-autocomplete__list-item--selected');\n  nextActiveItem.classList.add('as24-autocomplete__list-item--selected');\n  followSelectedItem(dir, list, nextActiveItem);\n  return false;\n};\n\nconst onKeyDown = (dataSource, valueInput, labelInput, list) => e => {\n  if (e.target === labelInput) {\n    if ([38, 40, 27].indexOf(e.which) >= 0) {\n      e.stopPropagation();\n      e.preventDefault();\n    }\n    if (e.which === 38) {\n      return moveSelection(-1, list);\n    }\n    if (e.which === 40) {\n      return isListVisible(list) ? moveSelection(1, list) : showList(list);\n    }\n    if (e.which === 27) {\n      return hideList(list)();\n    }\n  }\n};\n\nconst onKeyUp = (dataSource, valueInput, labelInput, list, emptyListMessage) => e => {\n  e.stopPropagation();\n  if (e.which === 13) {\n    selectItem(valueInput, labelInput, $('.as24-autocomplete__list-item--selected', list));\n    hideList(list)();\n    return;\n  }\n  if ([38, 40, 27].indexOf(e.which) === -1) {\n    return fetchList(dataSource, labelInput, list, emptyListMessage)(e);\n  }\n};\n\nfunction elementAttached() {\n  var emptyListMessage = this.getAttribute('empty-list-message') || \"---\";\n  var dataSourceName = this.getAttribute('data-source');\n  if (!dataSourceName) {\n    throw \"The data source is missing\";\n  }\n  var labelInput = $('[type=text]', this);\n  var valueInput = $('[type=hidden]', this);\n  var list = $('.as24-autocomplete__list', this);\n  var dataSource = $('#' + dataSourceName, document);\n  var fetchListCallback = fetchList(dataSource, labelInput, list, emptyListMessage);\n  on('click', hideList(list), document);\n  on('click', fetchListCallback, labelInput);\n  on('focus', fetchListCallback, labelInput);\n  on('click', onItemClicked(valueInput, labelInput, list), list);\n  on('keyup', onKeyUp(dataSource, valueInput, labelInput, list, emptyListMessage), labelInput);\n  // on('keydown', onKeyDown(dataSource, valueInput, labelInput, list), labelInput);\n  on('keydown', onKeyDown(dataSource, valueInput, labelInput, list), window);\n}\n\nfunction elementDetached() {}\n\nexport default function() {\n  try {\n    return document.registerElement('as24-autocomplete', {\n        prototype: Object.assign(\n            Object.create(HTMLElement.prototype, {\n                attachedCallback: { value: elementAttached },\n                detachedCallback: { value: elementDetached },\n                attributeChangedCallback: { value: function () { } }\n            })\n        )\n    });\n  } catch (e) {\n    if (window && window.console) {\n        window.console.warn('Failed to register CustomElement \"as24-autocomplete\".', e);\n        return null;\n    }\n  }\n}\n","var itemsCache = {};\n\nconst extractKeyValues = root =>\n  Array.prototype.slice.call(root.querySelectorAll('item')).map(tag => ({\n    key: tag.getAttribute('key'),\n    value: tag.getAttribute('value')\n  }));\n\nconst valuePredicate = queryString => item =>\n  item.value.match(new RegExp('^' + queryString, 'ig')) !== null;\n\nfunction fetchItems(queryString) {\n  var root = this;\n  var thisID = root.id;\n  return new Promise(res => {\n    itemsCache[thisID] = itemsCache[thisID] || extractKeyValues(root);\n    res(queryString ? itemsCache[thisID].filter(valuePredicate(queryString)) : itemsCache[thisID])\n  });\n}\n\nfunction elementAttached() {\n  itemsCache[this.id] = null;\n}\n\nfunction elementDetached() {\n  itemsCache[this.id] = null;\n}\n\nexport default function() {\n  try {\n    return document.registerElement('as24-tags-data-source', {\n        prototype: Object.assign(\n            Object.create(HTMLElement.prototype, {\n                attachedCallback: { value: elementAttached },\n                detachedCallback: { value: elementDetached },\n                attributeChangedCallback: { value: function () { } }\n            }), {\n                fetchItems: fetchItems\n            }\n        )\n    });\n  } catch(e) {\n      return null;\n  }\n}\n","import input from './as24-autocomplete-input';\nimport tagsDataSource from './data-sources/tags-data-source';\n\nexport default (function init() {\n    const inputCtr = input();\n    const tagsDataSourceCtr = tagsDataSource();\n    return {inputCtr, tagsDataSourceCtr};\n})();\n"],"names":["$","selector","root","querySelector","on","event","cb","el","addEventListener","appendTo","appendChild","child","target","showList","classList","add","hideList","remove","isListVisible","list","contains","renderLI","li","document","createElement","key","item","innerText","value","renderEmptyListItem","emptyMessage","renderList","innerHTML","df","createDocumentFragment","itemsModel","length","map","forEach","fetchList","dataSource","labelInput","stopPropagation","fetchItems","then","selectItem","valueInput","onItemClicked","e","followSelectedItem","dir","selected","listHeight","getBoundingClientRect","height","selectedTop","offsetTop","selectedHeight","offsetHeight","scrollDist","scrollTop","moveSelection","next","currActiveItem","nextActiveItem","onKeyDown","indexOf","which","preventDefault","onKeyUp","emptyListMessage","elementAttached","getAttribute","dataSourceName","fetchListCallback","window","elementDetached","registerElement","Object","assign","create","HTMLElement","prototype","console","warn","itemsCache","extractKeyValues","Array","slice","call","querySelectorAll","tag","valuePredicate","match","RegExp","queryString","thisID","id","Promise","filter","init","inputCtr","input","tagsDataSourceCtr","tagsDataSource"],"mappings":"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"}