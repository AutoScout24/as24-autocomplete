{"version":3,"names":[],"mappings":"","sources":["src/as24-autocomplete.js"],"sourcesContent":["function registerDS(){try{return document.registerElement(\"as24-autocomplete-input\",AutocompleteInput)}catch(t){return null}}function registerDS$1(){try{return document.registerElement(\"as24-plain-data-source\",PlainDataSource)}catch(t){return null}}function registerDS$2(){try{return document.registerElement(\"as24-grouped-items-data-source\",GroupedItemsDataSource)}catch(t){return null}}function registerDS$3(){try{return document.registerElement(\"as24-plain-suggestions-list\",PlainSuggestionsList)}catch(t){return null}}function registerDS$4(){try{return document.registerElement(\"as24-grouped-suggestions-list\",GroupedSuggestionsList)}catch(t){return null}}function register(){try{return document.registerElement(\"as24-autocomplete\",AutocompleteInput$1)}catch(t){return null}}var $=function(t,e){return e.querySelector(t)},$$=function(t,e){return e.querySelectorAll(t)},closestByTag=function(t){return function(e){return e?\"HTML\"===e.tagName?null:e===t?t:closestByTag(t)(e.parentNode):null}},on=function(t,e,o,i){return void 0===i&&(i=!1),o.addEventListener(t,e,i)},triggerEvent=function(t,e){var o=document.createEvent(\"Event\");o.initEvent(t,!0,!0),e.dispatchEvent(o)},appendTo=function(t){return function(e){return t.appendChild(e),t}},closestByClassName=function(t){return function(e){return\"HTML\"===e.tagName?null:e.classList.contains(t)?e:closestByClassName(t)(e.parentNode)}},AutocompleteInput=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setValue=function(t){this.input.value=t},e.prototype.getValue=function(){return this.input.value.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g,\"\\\\$&\")},e.prototype.setDisabled=function(t){t?this.input.setAttribute(\"disabled\",\"disabled\"):this.input.removeAttribute(\"disabled\")},e.prototype.isDisabled=function(){return this.input.hasAttribute(\"disabled\")},e.prototype.setError=function(t){this.input.classList[t?\"add\":\"remove\"](\"error\")},e.prototype.renderInput=function(){return function(t){return this.setError(0===t.length),t}.bind(this)},e.prototype.onKeyDown=function(t){9===t.which&&triggerEvent(\"as24-autocomplete:input:focus-lost\",this.input),40===t.which&&(triggerEvent(\"as24-autocomplete:input:go-down\",this.input),t.preventDefault()),38===t.which&&(triggerEvent(\"as24-autocomplete:input:go-up\",this.input),t.preventDefault())},e.prototype.onKeyUp=function(t){return!this.isVisible||13!==t.which&&9!==t.which?(13===t.which&&triggerEvent(\"as24-autocomplete:input:enter\",this.input),27===t.which&&this.onCrossClick(),40!==t.which&&38!==t.which&&13!==t.which&&27!==t.which&&triggerEvent(\"as24-autocomplete:input:query\",this.input),null):(t.stopPropagation(),t.preventDefault(),this.selectItem(),!1)},e.prototype.onInputFocus=function(){console.log(\"onInputFocus\"),this.isOpened=!0,triggerEvent(\"as24-autocomplete:input:trigger-suggestions\",this.input)},e.prototype.onCrossClick=function(){this.input.disabled||(this.input.focus(),\"\"===this.input.value?(console.log(1),this.isOpened?(console.log(2),this.isOpened=!1):(console.log(3),this.isOpened=!0,triggerEvent(\"as24-autocomplete:input:trigger-suggestions\",this.input))):(console.log(4),this.input.value=\"\",this.isOpened=!0,triggerEvent(\"as24-autocomplete:input:cleanup\",this.input)))},e.prototype.onBlur=function(){var t=this;console.log(\"onBlur\"),setTimeout(function(){\"\"===t.input.value?t.isOpened&&(t.isOpened=!1,triggerEvent(\"as24-autocomplete:input:restore-placeholder\",t.input),triggerEvent(\"as24-autocomplete:input:close\",t.input)):triggerEvent(\"as24-autocomplete:input:close-list\",t.input)},100)},e.prototype.onClick=function(t){t.stopPropagation()},e.prototype.attachedCallback=function(){this.isOpened=!1,this.isDirty=!1,this.dropDown=$(\".as24-autocomplete__icon-wrapper\",this),this.input=$(\"input\",this),on(\"focus\",this.onInputFocus.bind(this),this.input),on(\"keyup\",this.onKeyUp.bind(this),this.input,!0),on(\"keydown\",this.onKeyDown.bind(this),this.input,!0),on(\"click\",this.onCrossClick.bind(this),this.dropDown),on(\"click\",this.onClick.bind(this),this.input),on(\"blur\",this.onBlur.bind(this),this.input,this.dropDown)},e}(HTMLElement),Suggestion=function(t,e){this.key=t,this.value=e};Suggestion.prototype.toString=function(){return\"Suggestion(\"+this.key+\": \"+this.value+\")\"};var trimString=function(t){return t.split(String.fromCharCode(92)).join(\"\").split(\"&nbsp\").join(\"\").trim()},matchValuePredicate=function(t){return function(e){return null!==trimString(e.value).match(t)}},PlainDataSource=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.fetchItems=function(t){var e=this;return new Promise(function(o){var i=trimString(t),s=e.extractKeyValues(),n=matchValuePredicate(new RegExp(\"^\"+i,\"ig\")),r=matchValuePredicate(new RegExp(\"\"+i,\"ig\")),u=s.filter(function(t){return n(t)}),a=s.filter(function(t){return-1===u.indexOf(t)}).filter(function(t){return r(t)});return o(u.concat(a))})},e.prototype.getSuggestionByKey=function(t){var e=this;return new Promise(function(o,i){var s=e.extractKeyValues();return t&&s?o(s.filter(function(e){return e.key===t})[0]):i(null)})},e.prototype.extractKeyValues=function(){return Array.prototype.slice.call(this.querySelectorAll(\"item\")).map(function(t){return new Suggestion(t.getAttribute(\"key\"),t.getAttribute(\"value\"))})},e}(HTMLElement),Suggestion$1=function(t,e){this.key=t,this.value=e};Suggestion$1.prototype.toString=function(){return\"Suggestion(\"+this.key+\": \"+this.value+\")\"};var SuggestionsGroup=function(t,e){this.label=t,this.items=e};SuggestionsGroup.prototype.toString=function(){return\"SuggestionsGroup(\"+this.label+\", \"+this.items.length+\" items)\"};var valuePredicate=function(t,e){return function(o){return null!==t?null!==o.value.match(t):void 0===e||o.key===e}},GroupedItemsDataSource=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.fetchItems=function(t){var e=this;return new Promise(function(o){return o(e.buildGroups(t))})},e.prototype.getSuggestionByKey=function(t){var e=this;return new Promise(function(o,i){var s=Array.prototype.slice.call(e.querySelectorAll(\"item\")).map(function(t){return new Suggestion$1(t.getAttribute(\"key\"),t.getAttribute(\"value\"))}).filter(valuePredicate(null,t));return s.length?o(s[0]):i(null)})},e.prototype.buildItems=function(t,e,o){var i=Array.prototype.slice.call(t.querySelectorAll(\"item\")).map(function(t){return new Suggestion$1(t.getAttribute(\"key\"),t.getAttribute(\"value\"))}),s=i.filter(valuePredicate(new RegExp(\"^\"+e,\"ig\"),o)),n=i.filter(function(t){return-1===s.indexOf(t)}).filter(valuePredicate(new RegExp(\"\"+e,\"ig\"),o));return s.concat(n)},e.prototype.buildGroups=function(t,e){var o=this;return Array.prototype.slice.call(this.querySelectorAll(\"group\")).reduce(function(i,s){var n=o.buildItems(s,t,e);return n.length?i.concat(new SuggestionsGroup(s.getAttribute(\"label\"),n)):i},[])},e.prototype.extractKeyValues=function(){return Array.prototype.slice.call(this.querySelectorAll(\"item\")).map(function(t){return new Suggestion$1(t.getAttribute(\"key\"),t.getAttribute(\"value\"))})},e}(HTMLElement),PlainSuggestionsList=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.show=function(){console.log(\"show\"),this.classList.add(\"as24-autocomplete__list--visible\")},e.prototype.hide=function(){console.log(\"hide\"),this.classList.remove(\"as24-autocomplete__list--visible\")},e.prototype.isEmpty=function(){return $(\".as24-autocomplete__list-item--empty\",this)},e.prototype.isVisible=function(){return this.classList.contains(\"as24-autocomplete__list--visible\")},e.prototype.getSelectedSuggestionItem=function(){return $(\".as24-autocomplete__list-item--selected\",this)},e.prototype.scrollToSelectedItem=function(t){var e=this.getBoundingClientRect().height,o=t.offsetTop,i=t.offsetHeight;this.scrollTop=-1*(e-(o+i))},e.prototype.moveSelection=function(t){var e=1===t?\"nextSibling\":\"previousSibling\",o=this.getSelectedSuggestionItem(this),i=null===o?$(\".as24-autocomplete__list-item\",this):null!==o[e]?o[e]:o;o&&o.classList.remove(\"as24-autocomplete__list-item--selected\"),i.classList.add(\"as24-autocomplete__list-item--selected\"),this.scrollToSelectedItem(i)},e.prototype.moveSelectionMultiple=function(t,e){var o=this;Array(e).fill(1).forEach(function(t){return o.moveSelection(1)})},e.prototype.onItemMouseOver=function(t){t.stopPropagation();var e=$(\".as24-autocomplete__list-item--selected\",this);\"LI\"===t.target.tagName&&(e&&e.classList.remove(\"as24-autocomplete__list-item--selected\"),t.target.classList.add(\"as24-autocomplete__list-item--selected\"))},e.prototype.selectItem=function(){console.log(\"selectItem list\");var t=this.getSelectedSuggestionItem();t&&t.dataset.type&&\"selectable\"===t.dataset.type&&triggerEvent(\"as24-autocomplete:suggestion:selected\",t)},e.prototype.onClick=function(t){console.log(\"onClick list\");var e=closestByClassName(\"as24-autocomplete__list-item\")(t.target);e&&e.dataset.type&&\"selectable\"===e.dataset.type&&triggerEvent(\"as24-autocomplete:suggestion:selected\",e)},e.prototype.renderItem=function(t){return function(e){var o=document.createElement(\"li\");return o.classList.add(\"as24-autocomplete__list-item\"),o.dataset.key=e.key,o.dataset.type=\"selectable\",o.dataset.label=e.value,o.innerHTML=e.value.replace(new RegExp(\"(\"+t+\")\",\"ig\"),\"<strong>$1</strong>\"),o}},e.prototype.renderEmptyListItem=function(t){var e=document.createElement(\"li\");return[\"as24-autocomplete__list-item\",\"as24-autocomplete__list-item--empty\"].forEach(e.classList.add.bind(e.classList)),e.dataset.type=\"unselectable\",e.dataset.key=\"\",e.innerText=t,e},e.prototype.renderItems=function(t,e){return function(o){this.innerHTML=\"\";var i=document.createDocumentFragment();(o.length?o.map(this.renderItem(t)):[this.renderEmptyListItem(e)]).forEach(appendTo(i)),appendTo(this)(i)}.bind(this)},e.prototype.attachedCallback=function(){on(\"mouseover\",this.onItemMouseOver.bind(this),this),on(\"click\",this.onClick.bind(this),this)},e}(HTMLElement),GroupedSuggestionsList=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.show=function(){this.classList.add(\"as24-autocomplete__list--visible\")},e.prototype.hide=function(){this.classList.remove(\"as24-autocomplete__list--visible\")},e.prototype.isEmpty=function(){return $(\".as24-autocomplete__list-item--empty\",this)},e.prototype.isVisible=function(){return this.classList.contains(\"as24-autocomplete__list--visible\")},e.prototype.getSelectedSuggestionItem=function(){return $(\".as24-autocomplete__list-item--selected\",this)},e.prototype.scrollToSelectedItem=function(t){var e=this.getBoundingClientRect().height,o=t.offsetTop,i=t.offsetHeight;this.scrollTop=-1*(e-(o+i))},e.prototype.moveSelection=function(t){var e=this.getSelectedSuggestionItem(this),o=Array.prototype.slice.call($$(\".as24-autocomplete__list-item\",this)).filter(function(t){return\"selectable\"===t.dataset.type}),i=null===e?-1:o.indexOf(e),s=i+t>o.length-1?o.length-1:i+t<0?0:i+t,n=o[s];e&&e.classList.remove(\"as24-autocomplete__list-item--selected\"),n&&(n.classList.add(\"as24-autocomplete__list-item--selected\"),this.scrollToSelectedItem(n))},e.prototype.moveSelectionMultiple=function(t,e){var o=this;Array(e).fill(1).forEach(function(t){return o.moveSelection(1)})},e.prototype.onItemMouseOver=function(t){t.stopPropagation();var e=$(\".as24-autocomplete__list-item--selected\",this);\"LI\"===t.target.tagName&&(e&&e.classList.remove(\"as24-autocomplete__list-item--selected\"),t.target.classList.add(\"as24-autocomplete__list-item--selected\"))},e.prototype.selectItem=function(){var t=this.getSelectedSuggestionItem();t&&t.dataset.type&&\"selectable\"===t.dataset.type&&triggerEvent(\"as24-autocomplete:suggestion:selected\",t)},e.prototype.onClick=function(t){var e=closestByClassName(\"as24-autocomplete__list-item\")(t.target);e&&e.dataset.type&&\"selectable\"===e.dataset.type&&triggerEvent(\"as24-autocomplete:suggestion:selected\",e)},e.prototype.renderItem=function(t){return function(e){var o=document.createElement(\"li\");return o.classList.add(\"as24-autocomplete__list-item\"),o.dataset.key=e.key,o.dataset.type=\"selectable\",o.dataset.label=e.value,o.innerHTML=e.value.replace(new RegExp(\"(\"+t+\")\",\"ig\"),\"<strong>$1</strong>\"),o}},e.prototype.renderSeparator=function(t){var e=document.createElement(\"div\");return e.classList.add(\"as24-autocomplete__list-item\"),e.classList.add(\"as24-autocomplete__separator\"),e.dataset.type=\"unselectable\",e.innerHTML=t.label,e},e.prototype.renderGroup=function(t){return function(e){var o=document.createDocumentFragment();return 0===t.length&&o.appendChild(this.renderSeparator(e)),e.items.map(this.renderItem(t)).forEach(appendTo(o)),o}},e.prototype.renderEmptyListItem=function(t){var e=document.createElement(\"li\");return[\"as24-autocomplete__list-item\",\"as24-autocomplete__list-item--empty\"].forEach(e.classList.add.bind(e.classList)),e.dataset.type=\"unselectable\",e.innerText=t,e},e.prototype.renderItems=function(t,e){return function(o){this.innerHTML=\"\";var i=document.createDocumentFragment();(o.length?o.map(this.renderGroup(t).bind(this)):[this.renderEmptyListItem(e)]).forEach(appendTo(i)),appendTo(this)(i),this.show()}.bind(this)},e.prototype.attachedCallback=function(){on(\"mouseover\",this.onItemMouseOver.bind(this),this),on(\"click\",this.onClick.bind(this),this)},e}(HTMLElement),AutocompleteInput$1=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.selectedValue=function(){return this.valueInput.value},e.prototype.userQuery=function(){return this.userFacingInput.getValue()},e.prototype.userFacingInputElement=function(){return this.userFacingInput},e.prototype.dataSourceElement=function(){return this.dataSource},e.prototype.valueInputElement=function(){return this.valueInput},e.prototype.userQueryElement=function(){return this.userQueryEl},e.prototype.reset=function(){this.userFacingInput.setValue(\"\"),this.valueInput.value=\"\",this.list.hide(),this.isDirty=!1,this.classList.remove(\"as24-autocomplete--active\"),this.classList.remove(\"as24-autocomplete--user-input\")},e.prototype.fetchList=function(t){return this.dataSource.fetchItems(t).then(this.userFacingInput.renderInput()).then(this.list.renderItems(t,this.emptyListMessage))},e.prototype.getInitialValueByKey=function(){return this.dataSource.getSuggestionByKey(this.valueInput.value)},e.prototype.setValue=function(t){this.setKeyLabelPair(t,t)},e.prototype.setKeyLabelPair=function(t,e){this.valueInput.value=t,this.userFacingInput.setValue(e),this.userFacingInput.isOpened=!1,this.list.hide(),this.classList.remove(\"as24-autocomplete--active\"),this.classList.add(\"as24-autocomplete--user-input\"),triggerEvent(\"change\",this)},e.prototype.showList=function(){this.userQueryEl.placeholder=\"\",this.list.show()},e.prototype.restorePlaceholder=function(){console.log(\"restorePlaceholder\"),this.userQueryEl.placeholder=this.placeholder},e.prototype.attachedCallback=function(){var t=this;if(this.emptyListMessage=this.getAttribute(\"empty-list-message\")||\"---\",this.userFacingInput=$(\"as24-autocomplete-input\",this),this.userQueryEl=$('[data-role=\"user-query\"]',this),this.valueInput=$('input[data-role=\"value\"]',this),this.list=$('[data-role=\"list\"]',this),this.dataSource=this.querySelector(\"[role=data-source]\"),this.placeholder=this.userQueryEl.placeholder,!this.dataSource)throw new Error(\"The DataSource has not been found\");this.isDirty=!1,\"autocomplete\"in this.userQueryEl&&(this.userQueryEl.autocomplete=\"off\"),setTimeout(function(){t.valueInput.value&&t.getInitialValueByKey().then(function(e){return e&&(t.userFacingInput.setValue(e.value),t.classList.add(\"as24-autocomplete--user-input\"),t.isDirty=!0),!0})}),on(\"mouseleave\",function(){console.log(\"mouseleave\"),t.list.isVisible()&&(console.log(\"list.isVisible\"),t.restorePlaceholder())},this),on(\"as24-autocomplete:suggestion:selected\",function(e){console.log(\"as24-autocomplete:suggestion:selected\"),e.stopPropagation(),t.setKeyLabelPair(e.target.dataset.key,e.target.dataset.label)},this),on(\"as24-autocomplete:input:restore-placeholder\",function(e){console.log(\"as24-autocomplete:input:restore-placeholder\"),e.stopPropagation(),t.restorePlaceholder()},this),on(\"as24-autocomplete:input:trigger-suggestions\",function(e){console.log(\"as24-autocomplete:input:trigger-suggestions\"),e.stopPropagation(),t.list.isVisible()||t.showList();var o=t.selectedValue();t.classList.add(\"as24-autocomplete--active\"),t.fetchList(o?\"\":t.userFacingInput.getValue()).then(function(){return o?t.dataSourceElement().extractKeyValues().findIndex(function(t){return t.key===o})+1:0}).then(function(e){return t.list.moveSelectionMultiple(1,e)})},this),on(\"as24-autocomplete:input:focus-lost\",function(e){console.log(\"as24-autocomplete:input:focus-lost\"),e.stopPropagation(),\"\"===t.userFacingInput.getValue()||t.list.isEmpty()?(t.list.hide(),t.classList.remove(\"as24-autocomplete--active\")):t.list.selectItem()},this),on(\"as24-autocomplete:input:close-list\",function(e){console.log(\"as24-autocomplete:input:close-list\"),e.stopPropagation(),t.list.hide(),t.userFacingInput.isOpened=!1,t.classList.remove(\"as24-autocomplete--active\")},this),on(\"as24-autocomplete:input:enter\",function(e){console.log(\"as24-autocomplete:input:enter\"),e.stopPropagation(),t.list.isVisible()?(t.list.selectItem(),t.list.hide(),t.classList.remove(\"as24-autocomplete--active\")):(t.fetchList(t.userFacingInput.getValue()).then(function(){return t.list.moveSelection(1)}),t.classList.add(\"as24-autocomplete--active\"))},this),on(\"as24-autocomplete:input:query\",function(e){console.log(\"as24-autocomplete:input:query\"),e.stopPropagation(),\"\"!==t.userFacingInput.getValue()?(t.classList.add(\"as24-autocomplete--user-input\"),t.classList.add(\"as24-autocomplete--active\")):t.classList.remove(\"as24-autocomplete--user-input\"),t.fetchList(t.userFacingInput.getValue()).then(function(){t.list.moveSelection(1),t.valueInput.value.length>0&&(\"\"===t.userFacingInput.getValue()||t.list.isEmpty())&&(t.valueInput.value=\"\",triggerEvent(\"change\",t))})},this),on(\"as24-autocomplete:input:cleanup\",function(e){console.log(\"as24-autocomplete:input:cleanup\"),e.stopPropagation(),t.classList.remove(\"as24-autocomplete--user-input\"),t.classList.add(\"as24-autocomplete--active\"),t.valueInput.value=\"\",t.fetchList(\"\").then(function(){return t.list.moveSelection(1)}),triggerEvent(\"change\",t)},this),on(\"as24-autocomplete:input:close\",function(e){console.log(\"as24-autocomplete:input:close\"),e.stopPropagation(),t.classList.remove(\"as24-autocomplete--user-input\"),t.classList.remove(\"as24-autocomplete--active\"),t.list.hide()},this),on(\"as24-autocomplete:input:go-down\",function(e){console.log(\"as24-autocomplete:input:go-down\"),e.stopPropagation(),\"\"!==t.userFacingInput.getValue()&&t.classList.add(\"as24-autocomplete--active\"),t.list.isVisible()?t.list.moveSelection(1):t.fetchList(t.userFacingInput.getValue()).then(function(){return t.list.moveSelection(1)})},this),on(\"as24-autocomplete:input:go-up\",function(e){console.log(\"as24-autocomplete:input:go-up\"),e.stopPropagation(),t.list.isVisible()&&t.list.moveSelection(-1)},this),on(\"click\",function(e){document.querySelector(\".as24-autocomplete--active\")&&closestByTag(t)(e.target)!==t&&t.list.isVisible()&&(console.log(\"click\"),\"\"===t.userFacingInput.getValue()||t.list.isEmpty()||t.list.selectItem(),t.list.hide(),t.userFacingInput.isOpened=!1,t.classList.remove(\"as24-autocomplete--active\"))},document)},e.prototype.onAttributeChanged=function(t,e,o){\"disabled\"===t&&(this.userFacingInput.setDisabled(e!==o&&(\"true\"===o||\"disabled\"===o)),this.classList[this.userFacingInput.isDisabled()?\"add\":\"remove\"](\"as24-autocomplete--disabled\"),this.list.hide())},e}(HTMLElement);registerDS(),registerDS$1(),registerDS$2(),registerDS$3(),registerDS$4(),register();\n"],"file":"as24-autocomplete.js"}