{"version":3,"file":"as24-autocomplete.js","sources":["../src/as24-autocomplete-input.js","../src/data-sources/tags-data-source.js","../src/as24-autocomplete.js"],"sourcesContent":["const $ = (selector, root) => root.querySelector(selector);\nconst $$ = (selector, root) => root.querySelectorAll(selector);\nconst on = (event, cb, el) => el.addEventListener(event, cb);\nconst off = (event, cb, el) => el.removeEventListener(event, cb);\n\nconst appendTo = target => child => { target.appendChild(child); return target };\n\nconst renderLI = item => {\n  var li = document.createElement('li');\n  li.classList.add('as24-autocomplete__list-item');\n  li.key = item.key;\n  li.innerText = item.value;\n  return li;\n}\n\nconst renderList = list => itemsModel => {\n  list.innerHTML = '';\n  itemsModel.map(renderLI).forEach(appendTo(list));\n  list.classList.add('as24-autocomplete__list--visible');\n}\n\nconst toggleList = (list, dataSource) => e => {\n  e.stopPropagation();\n  e.target.tagName === 'INPUT'\n    ? dataSource.fetchItems().then(renderList(list))\n    : hideList(list)();\n}\n\nconst hideList = list => e =>\n  list.classList.remove('as24-autocomplete__list--visible');\n\nconst selectItem = (valueInput, labelInput, li) => {\n  valueInput.value = li.key;\n  labelInput.value = li.innerText;\n}\n\nconst onItemClicked = (valueInput, labelInput, list) => e => {\n  selectItem(valueInput, labelInput, e.target);\n  hideList(list)();\n}\n\nconst moveSelection = (dir, list) => {\n  var next = dir === 1 ? 'nextSibling' : 'previousSibling';\n  var currActiveItem = $('.as24-autocomplete__list-item--selected', list);\n  var nextActiveItem = currActiveItem === null\n    ? $('.as24-autocomplete__list-item', list)\n    : !!currActiveItem[next]\n      ? currActiveItem[next]\n      : currActiveItem;\n  currActiveItem && currActiveItem.classList.remove('as24-autocomplete__list-item--selected');\n  nextActiveItem.classList.add('as24-autocomplete__list-item--selected');\n}\n\nconst onKeyUpped = (dataSource, valueInput, labelInput, list) => e => {\n  switch(e.which) {\n    case 38: return moveSelection(-1, list);\n    case 40: return moveSelection(1, list);\n    case 27: return hideList(list)();\n    case 13: {\n      selectItem(valueInput, labelInput, $('.as24-autocomplete__list-item--selected', list));\n      hideList(list)();\n      return;\n    }\n    default: return dataSource.reduceItems(e.target.value).then(renderList(list));\n  }\n}\n\nfunction elementAttached() {\n  var labelInput = $('[type=text]', this);\n  var valueInput = $('[type=hidden]', this);\n  var list = $('.as24-autocomplete__list', this);\n  var dataSource = $('#' + this.getAttribute('data-source'), document);\n  on('click', hideList(list), document);\n  on('click', toggleList(list, dataSource), labelInput);\n  on('focus', toggleList(list, dataSource), labelInput);\n  on('click', onItemClicked(valueInput, labelInput, list), list);\n  on('keyup', onKeyUpped(dataSource, valueInput, labelInput, list), labelInput);\n}\n\nfunction elementDetached() {}\n\nexport default function() {\n  try {\n    document.registerElement('as24-autocomplete', {\n        prototype: Object.assign(\n            Object.create(HTMLElement.prototype, {\n                attachedCallback: { value: elementAttached },\n                detachedCallback: { value: elementDetached },\n                attributeChangedCallback: { value: function () { } }\n            })\n        )\n    });\n  } catch (e) {\n    if (window && window.console) {\n        window.console.warn('Failed to register CustomElement \"as24-autocomplete\".', e);\n    }\n  }\n}\n","var elementsCache = {};\nvar itemsCache = {};\n\nfunction fetchItems() {\n  var thisID = this.id;\n  return new Promise(res => {\n    var thisElement = elementsCache[thisID];\n    var items = thisElement.querySelectorAll('item');\n    itemsCache[thisID] = Array.from(items).map(tag => ({\n      key: tag.getAttribute('key'),\n      value: tag.getAttribute('value')\n    }));\n    res(itemsCache[thisID]);\n  });\n}\n\nfunction reduceItems(queryString) {\n  var thisID = this.id;\n  return new Promise(res => {\n    res((itemsCache[thisID] || []).filter(item => {\n      return item.value.match(new RegExp('^' + queryString, 'ig')) !== null;\n    }));\n  });\n}\n\nfunction elementAttached() {\n  itemsCache[this.id] = [];\n  elementsCache[this.id] = this;\n}\n\nfunction elementDetached() {\n  elementsCache[this.id] = null;\n  itemsCache[this.id] = null;\n}\n\nexport default function() {\n  try {\n    document.registerElement('as24-tags-data-source', {\n        prototype: Object.assign(\n            Object.create(HTMLElement.prototype, {\n                attachedCallback: { value: elementAttached },\n                detachedCallback: { value: elementDetached },\n                attributeChangedCallback: { value: function () { } }\n            }), {\n                fetchItems: fetchItems,\n                reduceItems: reduceItems\n            }\n        )\n    });\n  } catch(e) {\n  }\n}\n","import input from './as24-autocomplete-input';\nimport tagsDataSourse from './data-sources/tags-data-source';\n\ninput();\ntagsDataSourse();\n"],"names":["$","selector","root","querySelector","on","event","cb","el","addEventListener","appendTo","appendChild","child","target","renderLI","li","document","createElement","classList","add","key","item","innerText","value","renderList","innerHTML","map","forEach","list","toggleList","dataSource","stopPropagation","tagName","fetchItems","then","hideList","remove","selectItem","valueInput","labelInput","onItemClicked","e","moveSelection","dir","next","currActiveItem","nextActiveItem","onKeyUpped","which","reduceItems","elementAttached","getAttribute","elementDetached","registerElement","Object","assign","create","HTMLElement","prototype","window","console","warn","elementsCache","itemsCache","thisID","id","Promise","thisElement","items","querySelectorAll","Array","from","tag","queryString","filter","match","RegExp","input","tagsDataSourse"],"mappings":"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"}