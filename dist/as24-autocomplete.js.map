{"version":3,"file":"as24-autocomplete.js","sources":["../src/as24-autocomplete-input.js","../src/data-sources/tags-data-source.js","../src/as24-autocomplete.js"],"sourcesContent":["const $ = (selector, root) => root.querySelector(selector);\nconst on = (event, cb, el) => el.addEventListener(event, cb);\nconst off = (event, cb, el) => el.removeEventListener(event, cb);\n\nconst appendTo = target => child => {target.appendChild(child); return target};\n\nconst renderLI = item => {\n  var li = document.createElement('li');\n  li.classList.add('as24-autocomplete__list-item');\n  li.key = item.key;\n  li.innerText = item.value;\n  return li;\n}\n\nconst renderList = list => itemsModel => {\n  list.innerHTML = '';\n  itemsModel.map(renderLI).forEach(appendTo(list));\n  list.classList.add('as24-autocomplete__list--visible');\n}\n\nconst toggleList = (list, dataSource) => e => {\n  e.stopPropagation();\n  e.target.tagName === 'INPUT'\n    ? dataSource.fetchItems().then(renderList(list))\n    : hideList(list)();\n}\n\nconst onInputKeyup = dataSource => e => dataSource.reduceItems(e.target.value).then(renderList);\n\nconst hideList = list => e => list.classList.remove('as24-autocomplete__list--visible');\n\nconst onItemClicked = (valueInput, labelInput, list) => e => {\n  valueInput.value = e.target.key;\n  labelInput.value = e.target.innerText;\n  hideList(list)();\n}\n\nconst onKeyUpped = (valueInput, labelInput, list) => e => {\n  if (e.which === 13) {}\n  if (e.which === 27) {\n    hideList(list)();\n  }\n}\n\nfunction elementAttached() {\n  var labelInput = $('[type=text]', this);\n  var valueInput = $('[type=hidden]', this);\n  var list = $('.as24-autocomplete__list', this);\n  var dataSource = $('#' + this.getAttribute('data-source'), document);\n  on('click', hideList(list), document);\n  on('click', toggleList(list, dataSource), labelInput);\n  on('focus', toggleList(list, dataSource), labelInput);\n  on('keyup', onInputKeyup(dataSource), labelInput);\n  on('click', onItemClicked(valueInput, labelInput, list), list);\n  on('keyup', onKeyUpped(valueInput, labelInput, list), this);\n}\n\nfunction elementDetached() {}\n\nexport default function() {\n  try {\n    document.registerElement('as24-autocomplete', {\n        prototype: Object.assign(\n            Object.create(HTMLElement.prototype, {\n                attachedCallback: { value: elementAttached },\n                detachedCallback: { value: elementDetached },\n                attributeChangedCallback: { value: function () { } }\n            })\n        )\n    });\n  } catch (e) {\n    if (window && window.console) {\n        window.console.warn('Failed to register CustomElement \"as24-autocomplete\".', e);\n    }\n  }\n}\n","var elementsCache = {};\nvar itemsCache = {};\n\nfunction fetchItems() {\n  var thisID = this.id;\n  return new Promise(res => {\n    var thisElement = elementsCache[thisID];\n    var result = itemsCache[thisID]\n      ? itemsCache[thisID]\n      : Array.from(thisElement.querySelectorAll('item')).map(tag => {\n        return { key: tag.getAttribute('key'), value: tag.getAttribute('value') };\n      });\n    res(result);\n  });\n}\n\nfunction reduceItems(queryString) {\n  var thisID = this.id;\n  return new Promise(res => {\n    var reducedItems = (itemsCache[thisID] || []).filter(item => {\n      return item.value.match(new RegExp('^' + queryString, 'ig')) !== null;\n    });\n    res(reducedItems);\n  });\n}\n\nfunction elementAttached() {\n  elementsCache[this.id] = this;\n}\n\nfunction elementDetached() {\n  elementsCache[this.id] = null;\n  itemsCache[this.id] = null;\n}\n\nexport default function() {\n  try {\n    document.registerElement('as24-tags-data-source', {\n        prototype: Object.assign(\n            Object.create(HTMLElement.prototype, {\n                attachedCallback: { value: elementAttached },\n                detachedCallback: { value: elementDetached },\n                attributeChangedCallback: { value: function () { } }\n            }), {\n                fetchItems: fetchItems,\n                reduceItems: reduceItems\n            }\n        )\n    });\n  } catch(e) {\n  }\n}\n","import input from './as24-autocomplete-input';\nimport tagsDataSourse from './data-sources/tags-data-source';\n\ninput();\ntagsDataSourse();\n"],"names":["$","selector","root","querySelector","on","event","cb","el","addEventListener","appendTo","appendChild","child","target","renderLI","li","document","createElement","classList","add","key","item","innerText","value","renderList","innerHTML","map","forEach","list","toggleList","dataSource","stopPropagation","tagName","fetchItems","then","hideList","onInputKeyup","reduceItems","e","remove","onItemClicked","valueInput","labelInput","onKeyUpped","which","elementAttached","getAttribute","elementDetached","registerElement","Object","assign","create","HTMLElement","prototype","window","console","warn","elementsCache","itemsCache","thisID","id","Promise","thisElement","result","Array","from","querySelectorAll","tag","queryString","reducedItems","filter","match","RegExp","input","tagsDataSourse"],"mappings":"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"}