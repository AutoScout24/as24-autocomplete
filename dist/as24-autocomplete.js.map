{"version":3,"file":"as24-autocomplete.js","sources":["../src/as24-autocomplete-input.js","../src/data-sources/tags-data-source.js","../src/as24-autocomplete.js"],"sourcesContent":["const $ = (selector, root) => root.querySelector(selector);\nconst on = (event, cb, el) => el.addEventListener(event, cb);\nconst off = (event, cb, el) => el.removeEventListener(event, cb);\n\nconst appendTo = target => child => {target.appendChild(child); return target};\n\nconst renderLI = item => {\n  var li = document.createElement('li');\n  li.classList.add('as24-autocomplete__list-item');\n  li.key = item.key;\n  li.innerText = item.value;\n  return li;\n}\n\nconst renderList = list => itemsModel => {\n  list.innerHTML = '';\n  itemsModel.map(renderLI).forEach(appendTo(list));\n  list.classList.add('as24-autocomplete__list--visible');\n}\n\nconst onInputFocused = (list, dataSource) => e => dataSource.fetchItems().then(renderList(list));\n\nconst onInputKeyup = dataSource => e => dataSource.reduceItems(e.target.value).then(renderList);\n\nconst onItemClicked = (valueInput, labelInput, list) => e => {\n  valueInput.value = e.target.key;\n  labelInput.value = e.target.innerText;\n  list.classList.remove('as24-autocomplete__list--visible');\n}\n\nfunction elementAttached() {\n  var labelInput = $('[type=text]', this);\n  var valueInput = $('[type=hidden]', this);\n  var list = $('.as24-autocomplete__list', this);\n  var dataSource = $('#' + this.getAttribute('data-source'), document);\n  on('focus', onInputFocused(list, dataSource), labelInput);\n  on('keyup', onInputKeyup(dataSource), labelInput);\n  on('click', onItemClicked(valueInput, labelInput, list), list);\n}\n\nfunction elementDetached() {}\n\nexport default function() {\n  try {\n    document.registerElement('as24-autocomplete', {\n        prototype: Object.assign(\n            Object.create(HTMLElement.prototype, {\n                attachedCallback: { value: elementAttached },\n                detachedCallback: { value: elementDetached },\n                attributeChangedCallback: { value: function () { } }\n            })\n        )\n    });\n  } catch (e) {\n    if (window && window.console) {\n        window.console.warn('Failed to register CustomElement \"as24-autocomplete\".', e);\n    }\n  }\n}\n","var elementsCache = {};\nvar itemsCache = {};\n\nfunction fetchItems() {\n  var thisID = this.id;\n  return new Promise(res => {\n    var thisElement = elementsCache[thisID];\n    var result = itemsCache[thisID]\n      ? itemsCache[thisID]\n      : Array.from(thisElement.querySelectorAll('item')).map(tag => {\n        return { key: tag.getAttribute('key'), value: tag.getAttribute('value') };\n      });\n    res(result);\n  });\n}\n\nfunction reduceItems(queryString) {\n  var thisID = this.id;\n  return new Promise(res => {\n    var reducedItems = (itemsCache[thisID] || []).filter(item => {\n      return item.value.match(new RegExp('^' + queryString, 'ig')) !== null;\n    });\n    res(reducedItems);\n  });\n}\n\nfunction elementAttached() {\n  elementsCache[this.id] = this;\n}\n\nfunction elementDetached() {\n  elementsCache[this.id] = null;\n  itemsCache[this.id] = null;\n}\n\nexport default function() {\n  try {\n    document.registerElement('as24-tags-data-source', {\n        prototype: Object.assign(\n            Object.create(HTMLElement.prototype, {\n                attachedCallback: { value: elementAttached },\n                detachedCallback: { value: elementDetached },\n                attributeChangedCallback: { value: function () { } }\n            }), {\n                fetchItems: fetchItems,\n                reduceItems: reduceItems\n            }\n        )\n    });\n  } catch(e) {\n  }\n}\n","import input from './as24-autocomplete-input';\nimport tagsDataSourse from './data-sources/tags-data-source';\n\ninput();\ntagsDataSourse();\n"],"names":["$","selector","root","querySelector","on","event","cb","el","addEventListener","appendTo","appendChild","child","target","renderLI","li","document","createElement","classList","add","key","item","innerText","value","renderList","innerHTML","map","forEach","list","onInputFocused","dataSource","fetchItems","then","onInputKeyup","reduceItems","e","onItemClicked","valueInput","labelInput","remove","elementAttached","getAttribute","elementDetached","registerElement","Object","assign","create","HTMLElement","prototype","window","console","warn","elementsCache","itemsCache","thisID","id","Promise","thisElement","result","Array","from","querySelectorAll","tag","queryString","reducedItems","filter","match","RegExp","input","tagsDataSourse"],"mappings":"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"}