{"version":3,"file":"as24-autocomplete.js","sources":["../src/as24-autocomplete-input.js","../src/data-sources/tags-data-source.js","../src/as24-autocomplete.js"],"sourcesContent":["const $ = (selector, root) => root.querySelector(selector);\nconst $$ = (selector, root) => root.querySelectorAll(selector);\nconst on = (event, cb, el) => el.addEventListener(event, cb);\nconst off = (event, cb, el) => el.removeEventListener(event, cb);\n\nconst appendTo = target => child => { target.appendChild(child); return target };\n\nconst showList = list =>\n  list.classList.add('as24-autocomplete__list--visible');\n\nconst hideList = list => e =>\n  list.classList.remove('as24-autocomplete__list--visible');\n\nconst isListVisible = list =>\n  list.classList.contains('as24-autocomplete__list--visible');\n\nconst renderLI = item => {\n  var li = document.createElement('li');\n  li.classList.add('as24-autocomplete__list-item');\n  li.key = item.key;\n  li.innerText = item.value;\n  return li;\n}\n\nconst renderList = list => itemsModel => {\n  list.innerHTML = '';\n  var df = document.createDocumentFragment();\n  itemsModel.map(renderLI).forEach(appendTo(df));\n  appendTo(list)(df);\n  showList(list);\n}\n\nconst fetchList = (dataSource, labelInput, list) => e => {\n  e.stopPropagation();\n  dataSource.fetchItems(labelInput.value).then(renderList(list));\n}\n\nconst selectItem = (valueInput, labelInput, li) => {\n  valueInput.value = li.key;\n  labelInput.value = li.innerText;\n}\n\nconst onItemClicked = (valueInput, labelInput, list) => e => {\n  selectItem(valueInput, labelInput, e.target);\n  hideList(list)();\n}\n\nconst moveSelection = (dir, list) => {\n  var next = dir === 1 ? 'nextSibling' : 'previousSibling';\n  var currActiveItem = $('.as24-autocomplete__list-item--selected', list);\n  var nextActiveItem = currActiveItem === null\n    ? $('.as24-autocomplete__list-item', list)\n    : !!currActiveItem[next]\n      ? currActiveItem[next]\n      : currActiveItem;\n  currActiveItem && currActiveItem.classList.remove('as24-autocomplete__list-item--selected');\n  nextActiveItem.classList.add('as24-autocomplete__list-item--selected');\n  nextActiveItem.scrollIntoView();\n}\n\nconst onKeyDown = (dataSource, valueInput, labelInput, list) => e => {\n  switch(e.which) {\n    case 38: return moveSelection(-1, list);\n    case 40: return isListVisible(list) ? moveSelection(1, list) : showList(list);\n    case 27: return hideList(list)();\n  }\n}\n\nconst onKeyUp = (dataSource, valueInput, labelInput, list) => e => {\n  if (e.which === 13) {\n    selectItem(valueInput, labelInput, $('.as24-autocomplete__list-item--selected', list));\n    hideList(list)();\n    return;\n  }\n  if ([38,40,27].indexOf(e.which) === -1) {\n    return fetchList(dataSource, labelInput, list)(e);\n  }\n}\n\nfunction elementAttached() {\n  var labelInput = $('[type=text]', this);\n  var valueInput = $('[type=hidden]', this);\n  var list = $('.as24-autocomplete__list', this);\n  var dataSource = $('#' + this.getAttribute('data-source'), document);\n  on('click', hideList(list), document);\n  on('click', fetchList(dataSource, labelInput, list), labelInput);\n  on('focus', fetchList(dataSource, labelInput, list), labelInput);\n  on('click', onItemClicked(valueInput, labelInput, list), list);\n  on('keyup', onKeyUp(dataSource, valueInput, labelInput, list), labelInput);\n  on('keydown', onKeyDown(dataSource, valueInput, labelInput, list), labelInput);\n}\n\nfunction elementDetached() {}\n\nexport default function() {\n  try {\n    document.registerElement('as24-autocomplete', {\n        prototype: Object.assign(\n            Object.create(HTMLElement.prototype, {\n                attachedCallback: { value: elementAttached },\n                detachedCallback: { value: elementDetached },\n                attributeChangedCallback: { value: function () { } }\n            })\n        )\n    });\n  } catch (e) {\n    if (window && window.console) {\n        window.console.warn('Failed to register CustomElement \"as24-autocomplete\".', e);\n    }\n  }\n}\n","var elementsCache = {};\nvar itemsCache = {};\n\nconst extractKeyValues = root =>\n  Array.prototype.slice.call(root.querySelectorAll('item')).map(tag => ({\n    key: tag.getAttribute('key'),\n    value: tag.getAttribute('value')\n  }));\n\nconst valuePredicate = queryString => item =>\n  item.value.match(new RegExp('^' + queryString, 'ig')) !== null;\n\nfunction fetchItems(queryString) {\n  var thisID = this.id;\n  return new Promise(res => {\n    itemsCache[thisID] = itemsCache[thisID] || extractKeyValues(elementsCache[thisID]);\n    res(queryString ? itemsCache[thisID].filter(valuePredicate(queryString)) : itemsCache[thisID])\n  });\n}\n\nfunction elementAttached() {\n  itemsCache[this.id] = null;\n  elementsCache[this.id] = this;\n}\n\nfunction elementDetached() {\n  elementsCache[this.id] = null;\n  itemsCache[this.id] = null;\n}\n\nexport default function() {\n  try {\n    document.registerElement('as24-tags-data-source', {\n        prototype: Object.assign(\n            Object.create(HTMLElement.prototype, {\n                attachedCallback: { value: elementAttached },\n                detachedCallback: { value: elementDetached },\n                attributeChangedCallback: { value: function () { } }\n            }), {\n                fetchItems: fetchItems\n            }\n        )\n    });\n  } catch(e) {\n  }\n}\n","import input from './as24-autocomplete-input';\nimport tagsDataSourse from './data-sources/tags-data-source';\n\ninput();\ntagsDataSourse();\n"],"names":["$","selector","root","querySelector","on","event","cb","el","addEventListener","appendTo","appendChild","child","target","showList","list","classList","add","hideList","remove","isListVisible","contains","renderLI","li","document","createElement","key","item","innerText","value","renderList","innerHTML","df","createDocumentFragment","map","forEach","fetchList","dataSource","labelInput","stopPropagation","fetchItems","then","selectItem","valueInput","onItemClicked","e","moveSelection","dir","next","currActiveItem","nextActiveItem","scrollIntoView","onKeyDown","which","onKeyUp","indexOf","elementAttached","getAttribute","elementDetached","registerElement","Object","assign","create","HTMLElement","prototype","window","console","warn","elementsCache","itemsCache","extractKeyValues","Array","slice","call","querySelectorAll","tag","valuePredicate","match","RegExp","queryString","thisID","id","Promise","filter","input","tagsDataSourse"],"mappings":"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"}