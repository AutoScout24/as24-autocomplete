{"version":3,"file":"as24-autocomplete.js","sources":["../src/as24-autocomplete-input.js","../src/data-sources/tags-data-source.js","../src/as24-autocomplete.js"],"sourcesContent":["const $ = (selector, root) => root.querySelector(selector);\nconst $$ = (selector, root) => root.querySelectorAll(selector);\nconst on = (event, cb, el) => el.addEventListener(event, cb);\nconst off = (event, cb, el) => el.removeEventListener(event, cb);\n\nconst appendTo = target => child => {target.appendChild(child); return target};\n\nconst renderLI = item => {\n  var li = document.createElement('li');\n  li.classList.add('as24-autocomplete__list-item');\n  li.key = item.key;\n  li.innerText = item.value;\n  return li;\n}\n\nconst renderList = list => itemsModel => {\n  list.innerHTML = '';\n  itemsModel.map(renderLI).forEach(appendTo(list));\n  list.classList.add('as24-autocomplete__list--visible');\n}\n\nconst toggleList = (list, dataSource) => e => {\n  e.stopPropagation();\n  e.target.tagName === 'INPUT'\n    ? dataSource.fetchItems().then(renderList(list))\n    : hideList(list)();\n}\n\nconst onInputKeyup = dataSource => e => dataSource.reduceItems(e.target.value).then(renderList);\n\nconst hideList = list => e => list.classList.remove('as24-autocomplete__list--visible');\n\nconst selectItem = (valueInput, labelInput, li) => {\n  valueInput.value = li.key;\n  labelInput.value = li.innerText;\n}\n\nconst onItemClicked = (valueInput, labelInput, list) => e => {\n  selectItem(valueInput, labelInput, e.target);\n  hideList(list)();\n}\n\nconst onKeyUpped = (valueInput, labelInput, list) => e => {\n  var currActiveItem;\n  var nextActiveItem;\n\n  if (e.which === 38) {\n    currActiveItem = $('.as24-autocomplete__list-item--selected', list);\n    nextActiveItem = currActiveItem === null\n      ? $('.as24-autocomplete__list-item', list)\n      : !!currActiveItem.previousSibling\n        ? currActiveItem.previousSibling\n        : currActiveItem;\n    currActiveItem && currActiveItem.classList.remove('as24-autocomplete__list-item--selected');\n    nextActiveItem.classList.add('as24-autocomplete__list-item--selected');\n  }\n\n  if (e.which === 40) {\n    if (!list.classList.contains('as24-autocomplete__list--visible')) {\n      list.classList.add('as24-autocomplete__list--visible')\n      return;\n    }\n    currActiveItem = $('.as24-autocomplete__list-item--selected', list);\n    nextActiveItem = currActiveItem === null\n      ? $('.as24-autocomplete__list-item', list)\n      : !!currActiveItem.nextSibling\n        ? currActiveItem.nextSibling\n        : currActiveItem;\n    currActiveItem && currActiveItem.classList.remove('as24-autocomplete__list-item--selected');\n    nextActiveItem.classList.add('as24-autocomplete__list-item--selected');\n  }\n\n  if (e.which === 13) {\n    selectItem(valueInput, labelInput, $('.as24-autocomplete__list-item--selected', list));\n    hideList(list)();\n  }\n\n  if (e.which === 27) {\n    hideList(list)();\n  }\n}\n\nfunction elementAttached() {\n  var labelInput = $('[type=text]', this);\n  var valueInput = $('[type=hidden]', this);\n  var list = $('.as24-autocomplete__list', this);\n  var dataSource = $('#' + this.getAttribute('data-source'), document);\n  on('click', hideList(list), document);\n  on('click', toggleList(list, dataSource), labelInput);\n  on('focus', toggleList(list, dataSource), labelInput);\n  on('keyup', onInputKeyup(dataSource), labelInput);\n  on('click', onItemClicked(valueInput, labelInput, list), list);\n  on('keyup', onKeyUpped(valueInput, labelInput, list), this);\n}\n\nfunction elementDetached() {}\n\nexport default function() {\n  try {\n    document.registerElement('as24-autocomplete', {\n        prototype: Object.assign(\n            Object.create(HTMLElement.prototype, {\n                attachedCallback: { value: elementAttached },\n                detachedCallback: { value: elementDetached },\n                attributeChangedCallback: { value: function () { } }\n            })\n        )\n    });\n  } catch (e) {\n    if (window && window.console) {\n        window.console.warn('Failed to register CustomElement \"as24-autocomplete\".', e);\n    }\n  }\n}\n","var elementsCache = {};\nvar itemsCache = {};\n\nfunction fetchItems() {\n  var thisID = this.id;\n  return new Promise(res => {\n    var thisElement = elementsCache[thisID];\n    var result = itemsCache[thisID]\n      ? itemsCache[thisID]\n      : Array.from(thisElement.querySelectorAll('item')).map(tag => {\n        return { key: tag.getAttribute('key'), value: tag.getAttribute('value') };\n      });\n    res(result);\n  });\n}\n\nfunction reduceItems(queryString) {\n  var thisID = this.id;\n  return new Promise(res => {\n    var reducedItems = (itemsCache[thisID] || []).filter(item => {\n      return item.value.match(new RegExp('^' + queryString, 'ig')) !== null;\n    });\n    res(reducedItems);\n  });\n}\n\nfunction elementAttached() {\n  elementsCache[this.id] = this;\n}\n\nfunction elementDetached() {\n  elementsCache[this.id] = null;\n  itemsCache[this.id] = null;\n}\n\nexport default function() {\n  try {\n    document.registerElement('as24-tags-data-source', {\n        prototype: Object.assign(\n            Object.create(HTMLElement.prototype, {\n                attachedCallback: { value: elementAttached },\n                detachedCallback: { value: elementDetached },\n                attributeChangedCallback: { value: function () { } }\n            }), {\n                fetchItems: fetchItems,\n                reduceItems: reduceItems\n            }\n        )\n    });\n  } catch(e) {\n  }\n}\n","import input from './as24-autocomplete-input';\nimport tagsDataSourse from './data-sources/tags-data-source';\n\ninput();\ntagsDataSourse();\n"],"names":["$","selector","root","querySelector","on","event","cb","el","addEventListener","appendTo","appendChild","child","target","renderLI","li","document","createElement","classList","add","key","item","innerText","value","renderList","innerHTML","map","forEach","list","toggleList","dataSource","stopPropagation","tagName","fetchItems","then","hideList","onInputKeyup","reduceItems","e","remove","selectItem","valueInput","labelInput","onItemClicked","onKeyUpped","currActiveItem","nextActiveItem","which","previousSibling","contains","nextSibling","elementAttached","getAttribute","elementDetached","registerElement","Object","assign","create","HTMLElement","prototype","window","console","warn","elementsCache","itemsCache","thisID","id","Promise","thisElement","result","Array","from","querySelectorAll","tag","queryString","reducedItems","filter","match","RegExp","input","tagsDataSourse"],"mappings":"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"}