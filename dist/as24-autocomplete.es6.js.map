{"version":3,"file":"as24-autocomplete.es6.js","sources":["../src/as24-autocomplete-input.js","../src/data-sources/tags-data-source.js","../src/as24-autocomplete.js"],"sourcesContent":["/**\n * @class DOMEvent\n * @property {HTMLElement} target\n * @property {number} which\n * @property {function} stopPropagation\n * @property {function} preventDefault\n */\n\n\n\n/**\n * @callback fetchItemsFn\n * @param {string} userInput\n * @return {Promise}\n */\n\n\n\n/**\n * Finds a closest element by class name\n * @param className\n * @returns {function}\n */\nconst closestByClassName = className =>\n    /**\n     * @param {HTMLElement} elem\n     * @return {HTMLElement}\n     */\n    elem =>\n        elem.classList.contains(className)\n            ? elem\n            : closestByClassName(className)(elem.parentElement);\n\n\n\n/**\n * Selects an element using the root element.\n * @param {string} selector Specifies the selector for lookup\n * @param {Element} root Specified within which element to perform the lookup\n * @return {Element}\n */\nconst $ = (selector, root) =>\n    root.querySelector(selector);\n\n\n\n/**\n * Binds an event listener on the element\n * @param {string} event\n * @param {Function} cb\n * @param {Element|Window|Document} el\n * @param {boolean} capturing\n */\nconst on = (event, cb, el, capturing = false) =>\n    el.addEventListener(event, cb, capturing);\n\n\n\n/**\n * Appends a child element to a target element\n * @param {HTMLElement|DocumentFragment} target\n * @returns {function}\n */\nconst appendTo = target =>\n    /**\n     * @param {HTMLElement} child\n     * @return {HTMLElement}\n     */\n    child => {\n        target.appendChild(child);\n        return target;\n    };\n\n\n\n/**\n* Finds the currently selected suggestion item\n* @param {HTMLUListElement} list\n* @returns {HTMLLIElement}\n*/\nconst getSelectedSuggestionItem = list =>\n    $('.as24-autocomplete__list-item--selected', list);\n\n\n\n/**\n*\n* @param {HTMLElement} list\n* @param {HTMLElement} selected\n*/\nconst followSelectedItem = (list, selected) => {\n    const listHeight = list.getBoundingClientRect().height;\n    const selectedTop = selected.offsetTop;\n    const selectedHeight = selected.offsetHeight;\n    list.scrollTop = -1 * (listHeight - (selectedTop + selectedHeight));\n};\n\n\n\n/**\n * Selected next/prev suggestion item\n * @param {number} dir\n * @param {HTMLUListElement} list\n * @return {boolean}\n */\nconst moveSelection = (dir, list) => {\n    const next = dir === 1 ? 'nextSibling' : 'previousSibling';\n    const currActiveItem = getSelectedSuggestionItem(list);\n    const nextActiveItem = currActiveItem === null\n        ? $('.as24-autocomplete__list-item', list)\n        : currActiveItem[next] !== null\n            ? currActiveItem[next]\n            : currActiveItem;\n    if (currActiveItem) {\n        currActiveItem.classList.remove('as24-autocomplete__list-item--selected');\n    }\n    nextActiveItem.classList.add('as24-autocomplete__list-item--selected');\n    followSelectedItem(list, nextActiveItem);\n    return false;\n};\n\n\n\n/**\n * Shows the suggestions list\n * @param {HTMLUListElement} list\n * @return {boolean}\n */\nconst showList = list => {\n    list.classList.add('as24-autocomplete__list--visible');\n    moveSelection(1, list);\n    return false;\n};\n\n\n\n/**\n * Hides the list and deactivates the root element\n * @param {HTMLUListElement} list\n * @param {Element} rootElement\n */\nconst hideList = (list, rootElement) => () => {\n    rootElement.classList.remove('as24-autocomplete--active');\n    list.classList.remove('as24-autocomplete__list--visible');\n    return false;\n};\n\n\n\n/**\n * Checks whether the list is visisible\n * @param {Element} list\n */\nconst isListVisible = list =>\n    list.classList.contains('as24-autocomplete__list--visible');\n\n\n\n/**\n * When user clicks cross icon, all the input must be removed\n * @param {HTMLInputElement} valueInput\n * @param {HTMLInputElement} labelInput\n * @param {Element} root\n * @return {*}\n */\nconst cleanup = (valueInput, labelInput, root) => {\n    valueInput.value = '';\n    labelInput.value = '';\n    root.classList.remove('as24-autocomplete--user-input');\n};\n\n\n\n/**\n * When user types something in we mark the component as dirty\n * @param {Element} rootElement\n * @return {*}\n */\nconst dirtifyInput = (rootElement) =>\n    rootElement.classList.add('as24-autocomplete--user-input');\n\n\n\n/**\n * Renders a li item for the suggestions list\n * @param {string} searchStr\n * @returns {function}\n */\nconst renderLI = searchStr =>\n    /**\n     * @param {Suggestion} item\n     * @returns {HTMLLIElement}\n     */\n    item => {\n        const li = document.createElement('li');\n        const searchValue = searchStr;\n        const resultValue = item.value.replace(new RegExp(`^${searchValue}`, 'gi'), '');\n        li.classList.add('as24-autocomplete__list-item');\n        li.dataset.key = item.key;\n        (li.innerHTML = searchStr.length\n            ? `<strong>${searchValue}</strong>${resultValue}`\n            : resultValue);\n        return li;\n    };\n\n\n\n/**\n * What to render when there is nothing to suggest\n * @param {String} emptyMessage\n * @returns {HTMLLIElement}\n */\nconst renderEmptyListItem = emptyMessage => {\n    /**\n     * @type {HTMLLIElement}\n     */\n    const li = document.createElement('li');\n    li.classList.add('as24-autocomplete__list-item');\n    li.dataset.key = '';\n    li.innerText = emptyMessage;\n    return li;\n};\n\n\n\n/**\n * Renders a collection of raw suggestions to the list\n * @param {string} emptyMessage\n * @param {HTMLElement} list\n * @param {HTMLInputElement} labelInput\n * @returns {Function}\n */\nconst renderList = (emptyMessage, list, labelInput) =>\n    /**\n     * @param {Array<Suggestion>} suggestions\n     */\n    suggestions => {\n        list.innerHTML = '';\n        const df = document.createDocumentFragment();\n\n        (suggestions.length\n            ? suggestions.map(renderLI(labelInput.value))\n            : [renderEmptyListItem(emptyMessage)]\n        ).forEach(appendTo(df));\n\n        list.classList[suggestions.length ? 'remove' : 'add']('as24-autocomplete__list--empty');\n        appendTo(list)(df);\n        showList(list);\n    };\n\n\n\n/**\n * Fetch data according to user input and renders the list\n * @param {DataSource} dataSource\n * @param {HTMLInputElement} labelInput\n * @param {Element} list\n * @param {String} emptyMessage\n * @param {Element} rootElement\n * @returns {function}\n */\nconst fetchList = (dataSource, labelInput, list, emptyMessage, rootElement) =>\n    /**\n     * @function\n     * @param {DOMEvent} e\n     * @return {undefined}\n     */\n    e => {\n        e.stopPropagation();\n        rootElement.classList.add('as24-autocomplete--active');\n        dataSource.fetchItems(labelInput.value).then(renderList(emptyMessage, list, labelInput));\n    };\n\n\n/**\n *\n * @param {string} eventName\n * @param {HTMLInputElement} el\n */\nconst triggerChangeEvent = (eventName, el) => {\n    const evt = document.createEvent('Event');\n    evt.initEvent(eventName, true, true);\n    el.dispatchEvent(evt);\n};\n\n\n/**\n * This is what happens after the user selected an item\n * @param {HTMLInputElement} valueInput\n * @param {HTMLInputElement} labelInput\n * @param {HTMLLIElement} li\n * @param {Element} rootElement\n */\nconst selectItem = (valueInput, labelInput, li, rootElement) => {\n    valueInput.value = li.dataset.key;\n    labelInput.value = li.innerText;\n    triggerChangeEvent('change', valueInput);\n    dirtifyInput(rootElement);\n};\n\n\n\n/**\n * This is what happens then user clicked in the suggestion item\n * @param {HTMLInputElement} valueInput\n * @param {HTMLInputElement} labelInput\n * @param {HTMLUListElement} list\n * @param {HTMLElement} rootElement\n */\nconst onItemClicked = (valueInput, labelInput, list, rootElement) => e => {\n    selectItem(valueInput, labelInput, closestByClassName('as24-autocomplete__list-item')(e.target), rootElement);\n    rootElement.classList.add('as24-autocomplete--user-input');\n    hideList(list, rootElement)(e);\n};\n\n\n\n/**\n * When mouse goes over the suggestion item\n * @param {HTMLUListElement} list\n * @return {function} a function that accepts an event\n */\nconst onItemMouseOver = list =>\n    /**\n     * @function\n     * @param {DOMEvent} e\n     * @return {undefined}\n     */\n    e => {\n        e.stopPropagation();\n        const preselected = $('.as24-autocomplete__list-item--preselected', list);\n        if (e.target.tagName === 'LI') {\n            if (preselected) {\n                preselected.classList.remove('as24-autocomplete__list-item--preselected');\n            }\n            e.target.classList.add('as24-autocomplete__list-item--preselected');\n        }\n    };\n\n\n\n/**\n * Handles key down event from the label input\n * @param {DataSource} dataSource\n * @param {HTMLInputElement} valueInput\n * @param {HTMLInputElement} labelInput\n * @param {HTMLUListElement} list\n * @param {string} emptyListMessage\n * @param {Element} rootElement\n * @return {function}\n */\nconst onKeyDown = (dataSource, valueInput, labelInput, list, emptyListMessage, rootElement) =>\n    /**\n     * @function\n     * @param {DOMEvent} e\n     * @return {undefined}\n     */\n    e => {\n        if (e.target === labelInput) {\n            if ([38, 40, 27].indexOf(e.which) >= 0) {\n                e.stopPropagation();\n                e.preventDefault();\n            }\n            if (e.which === 9) {\n                if (isListVisible(list)) {\n                    selectItem(valueInput, labelInput,\n                        getSelectedSuggestionItem(list),\n                        rootElement\n                    );\n                    hideList(list, rootElement)(e);\n                }\n            }\n            if (e.which === 38) {\n                return moveSelection(-1, list);\n            }\n            if (e.which === 40) {\n                return isListVisible(list)\n                    ? moveSelection(1, list)\n                    : fetchList(dataSource, labelInput, list,\n                        emptyListMessage, rootElement)(e);\n            }\n            if (e.which === 27) {\n                cleanup(valueInput, labelInput, rootElement);\n                return hideList(list, rootElement)();\n            }\n        }\n        return null;\n    };\n\n\n\n/**\n * Handles key up event from the label input\n * @param {DataSource} dataSource\n * @param {HTMLInputElement} valueInput\n * @param {HTMLInputElement} labelInput\n * @param {HTMLUListElement} list\n * @param {string} emptyListMessage\n * @param {Element} rootElement\n * @return {function}\n */\nconst onKeyUp = (dataSource, valueInput, labelInput, list, emptyListMessage, rootElement) =>\n    /**\n     * @function\n     * @param {DOMEvent} e\n     * @return {*}\n     */\n    e => {\n        if (labelInput.value) {\n            dirtifyInput(rootElement);\n        } else {\n            cleanup(valueInput, labelInput, rootElement);\n        }\n        if (isListVisible(list) && (e.which === 13 || e.which === 9)) {\n            e.stopPropagation();\n            e.preventDefault();\n            selectItem(valueInput, labelInput, getSelectedSuggestionItem(list), rootElement);\n            hideList(list, rootElement)();\n            return false;\n        }\n        if ([38, 40, 27].indexOf(e.which) === -1) {\n            e.stopPropagation();\n            return fetchList(dataSource, labelInput, list, emptyListMessage, rootElement)(e);\n        }\n        return null;\n    };\n\n\n\n/**\n * Handles the click on the arrow icon\n * @param {HTMLUListElement} list\n * @param {HTMLInputElement} labelInput\n * @param {Function} fetchListFn\n * @param {Element} root\n * @returns {function}\n */\nconst handleArrowClick = (list, labelInput, fetchListFn, root) =>\n    /**\n     * @function\n     * @param {DOMEvent} e\n     * @return {undefined}\n     */\n    e => {\n        e.stopPropagation();\n        if (isListVisible(list)) {\n            hideList(list, root)(e);\n        } else {\n            labelInput.focus();\n            fetchListFn(e);\n        }\n    };\n\n\n\n/**\n * Handles the click on the arrow icon\n * @param {HTMLUListElement} list\n * @param {HTMLInputElement} valueInput\n * @param {HTMLInputElement} labelInput\n * @param {Function} fetchListFn\n * @param {Element} root\n * @returns {function}\n */\nconst handleCrossClick = (list, valueInput, labelInput, fetchListFn, root) =>\n    /**\n     * @function\n     * @param {DOMEvent} e\n     * @return {undefined}\n     */\n    e => {\n        cleanup(valueInput, labelInput, root);\n        if (isListVisible(list)) {\n            fetchListFn(e);\n            labelInput.focus();\n        }\n    };\n\n\n/**\n * When the custom tag has been attached to DOM\n * @this HTMLElement\n */\nfunction elementAttached() {\n    /**\n     * The as24-autocomplete DOM element\n     * @type {HTMLElement}\n     */\n    const root = this;\n\n    /**\n     * The message about no items has been found\n     * @type {string}\n     */\n    const emptyListMessage = root.getAttribute('empty-list-message') || '---';\n\n    /**\n     * The id of the data-source element\n     * @type {string}\n     */\n    const dataSourceName = root.getAttribute('data-source');\n\n    if (!dataSourceName) {\n        throw new Error('The data source is missing');\n    }\n\n    /**\n     * The input with which the user can interact\n     * @type {HTMLInputElement}\n     */\n    const userFacingInput = $('[type=text]', root);\n\n    // Set the predefined query\n    userFacingInput.value = this.getAttribute('initial-query')\n        ? this.getAttribute('initial-query')\n        : '';\n\n    /**\n     * Hidden input in which we actually set the value\n     * @type {HTMLInputElement}\n     */\n    const valueInput = $('[type=hidden]', root);\n\n    /**\n     * The UL-element that represents the suggestion list\n     * @type {HTMLUListElement}\n     */\n    const list = $('.as24-autocomplete__list', root);\n\n    /**\n     * The arrow down icon\n     * @type {HTMLDivElement}\n     */\n    const iconDropdown = $('.as24-autocomplete__icon-dropdown', root);\n\n    /**\n     * The cross-arrow icon\n     * @type {*}\n     */\n    const iconCross = $('.as24-autocomplete__icon-cross', root);\n\n    /**\n     * DataSource element\n     * @type {DataSource}\n     */\n    const dataSource = $(`#${dataSourceName}`, document);\n\n    /**\n     * The function that takes an Event and does call to DataSource\n     * @type {Function}\n     */\n    const fetchListFn = fetchList(dataSource, userFacingInput, list, emptyListMessage, root);\n\n    if (iconDropdown) {\n        on('click', handleArrowClick(list, userFacingInput, fetchListFn, this), iconDropdown);\n    }\n\n    if (iconCross) {\n        on('click', handleCrossClick(list, valueInput, userFacingInput, fetchListFn, this), iconCross);\n    }\n\n    on('click', hideList(list, root), document);\n    on('click', fetchListFn, userFacingInput);\n    on('click', onItemClicked(valueInput, userFacingInput, list, root), list);\n    on('keyup', onKeyUp(dataSource, valueInput, userFacingInput, list, emptyListMessage, root), userFacingInput, true);\n    on('keydown', onKeyDown(dataSource, valueInput, userFacingInput, list, emptyListMessage, root), window, true);\n    on('mouseover', onItemMouseOver(list), list, true);\n}\n\n\n\nfunction elementDetached() { }\n\n\n\nexport default function() {\n    try {\n        return document.registerElement('as24-autocomplete', {\n            prototype: Object.assign(\n                Object.create(HTMLElement.prototype, {\n                    attachedCallback: { value: elementAttached },\n                    detachedCallback: { value: elementDetached },\n                    attributeChangedCallback: {\n                        value() {}\n                    }\n                })\n            )\n        });\n    } catch (e) {\n        if (window && window.console) {\n            window.console.warn('Failed to register CustomElement \"as24-autocomplete\".', e);\n            return null;\n        }\n    }\n    return true;\n}\n","/**\n * @class\n * @typedef Suggestion\n */\nclass Suggestion {\n    /**\n     * @property {string} key\n     * @property {string} value\n     */\n    constructor(key, value) {\n        this.key = key;\n        this.value = value;\n    }\n\n    toString() {\n        return `Suggestion(${this.key}: ${this.value})`;\n    }\n}\n\n/**\n * Test the string against item's value\n * @param {string} queryString\n * @returns {function}\n */\nconst valuePredicate = queryString =>\n    /**\n     * @param {Suggestion} item\n     */\n    item =>\n        item.value.match(new RegExp(`^${queryString}`, 'ig')) !== null;\n\n\n/**\n * @class\n * @typedef DataSource\n */\nclass DataSource extends HTMLElement {\n    /**\n     * @param {string} queryString\n     * @return {Promise.<Array<Suggestion>>}\n     */\n    fetchItems(queryString) {\n        return new Promise(res =>\n            res(this.extractKeyValues().filter(\n                valuePredicate(queryString)\n            ))\n        );\n    }\n\n    /**\n     * Extracts a list of objects like { key:string, value:string }\n     * @returns {Array<{key:string, value:string}>}\n     */\n    extractKeyValues() {\n        return Array.prototype.slice.call(this.querySelectorAll('item')).map(tag =>\n            new Suggestion(tag.getAttribute('key'), tag.getAttribute('value'))\n        );\n    }\n}\n\nexport default function() {\n    try {\n        return document.registerElement('as24-tags-data-source', DataSource);\n    } catch (e) {\n        return null;\n    }\n}\n","import input from './as24-autocomplete-input';\nimport tagsDataSource from './data-sources/tags-data-source';\n\nexport default (function init() {\n    const inputCtr = input();\n    const tagsDataSourceCtr = tagsDataSource();\n    return { inputCtr, tagsDataSourceCtr };\n}());\n"],"names":["closestByClassName","elem","classList","contains","className","parentElement","$","selector","root","querySelector","on","event","cb","el","capturing","addEventListener","appendTo","appendChild","child","target","getSelectedSuggestionItem","list","followSelectedItem","selected","listHeight","getBoundingClientRect","height","selectedTop","offsetTop","selectedHeight","offsetHeight","scrollTop","moveSelection","dir","next","currActiveItem","nextActiveItem","remove","add","showList","hideList","rootElement","isListVisible","cleanup","valueInput","labelInput","value","dirtifyInput","renderLI","li","document","createElement","searchValue","searchStr","resultValue","item","replace","RegExp","dataset","key","innerHTML","length","renderEmptyListItem","innerText","emptyMessage","renderList","df","createDocumentFragment","suggestions","map","forEach","fetchList","dataSource","stopPropagation","fetchItems","then","triggerChangeEvent","eventName","evt","createEvent","initEvent","dispatchEvent","selectItem","onItemClicked","e","onItemMouseOver","preselected","tagName","onKeyDown","emptyListMessage","indexOf","which","preventDefault","onKeyUp","handleArrowClick","fetchListFn","focus","handleCrossClick","elementAttached","getAttribute","dataSourceName","Error","userFacingInput","iconDropdown","iconCross","window","elementDetached","registerElement","Object","assign","create","HTMLElement","prototype","console","warn","Suggestion","valuePredicate","match","queryString","DataSource","Promise","res","extractKeyValues","filter","Array","slice","call","querySelectorAll","tag","init","inputCtr","input","tagsDataSourceCtr","tagsDataSource"],"mappings":"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"}